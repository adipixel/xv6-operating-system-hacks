#include "types.h"
#include "defs.h"
#include "param.h"
#include "memlayout.h"
#include "mmu.h"
#include "proc.h"
#include "x86.h"
#include "syscall.h"


void datecall(struct rtcdate *r)
{
	cmostime(r);
}


int sys_aaICO(void) { return 413; }
int sys_RwwzQ(void) { return 523; }
int sys_vPlkH(void) { return 485; }
int sys_nAAkW(void) { return 434; }
int sys_V4XHy(void) { return 419; }
int sys_DIJ1J(void) { return 338; }
int sys_uby8E(void) { return 461; }
int sys_HrYmw(void) { return 503; }
int sys_It9GD(void) { return 385; }
int sys_kBqyL(void) { return 483; }
int sys_uFvqh(void) { return 522; }
int sys_kCOzo(void) { return 486; }
int sys_BdglP(void) { return 457; }
int sys_vsu9T(void) { return 491; }
int sys_GhENr(void) { return 436; }
int sys_cNlc2(void) { return 434; }
int sys_AUX47(void) { return 345; }
int sys_OJjUF(void) { return 414; }
int sys_rwbCB(void) { return 464; }
int sys_U63O6(void) { return 323; }
int sys_buYn9(void) { return 471; }
int sys_pvRfc(void) { return 513; }
int sys_IbIsf(void) { return 461; }
int sys_RH7FR(void) { return 361; }
int sys_u5Ncu(void) { return 464; }
int sys_vA3kF(void) { return 411; }
int sys_ZyJFv(void) { return 473; }
int sys_a_kuY(void) { return 505; }
int sys_DF2ak(void) { return 392; }
int sys_bifXB(void) { return 459; }
int sys_OpuAe(void) { return 474; }
int sys_DNUxN(void) { return 429; }
int sys_ancIB(void) { return 445; }
int sys_fiuCL(void) { return 467; }
int sys_f85c4(void) { return 362; }
int sys_pKQyj(void) { return 495; }
int sys_sPh9f(void) { return 458; }
int sys_aSdV9(void) { return 423; }
int sys_hEwee(void) { return 494; }
int sys_m7xSo(void) { return 478; }
int sys_lpg5S(void) { return 459; }
int sys_J7GF1(void) { return 319; }
int sys_GYEGy(void) { return 421; }
int sys_UHuoA(void) { return 450; }
int sys_lfawm(void) { return 535; }
int sys_SkxVQ(void) { return 477; }
int sys_m7dk_(void) { return 466; }
int sys_C2FTH(void) { return 343; }
int sys_ZFvwG(void) { return 468; }
int sys_xMznMiMbd2ASBAopjUBD(void) { return 1763; }

int sys_ajJ2rUS36Ds7gCvYhWvRMQ4cM(void) { return 2106; }
int sys_lcQQ6(void) { return 423; }
int sys_tG0cd(void) { return 434; }
int sys_BQaye(void) { return 466; }
int sys_vRL61(void) { return 379; }
int sys_BfPAS(void) { return 396; }
int sys_VWqcU(void) { return 470; }
int sys_rNV_x(void) { return 493; }
int sys_m9TVP(void) { return 416; }
int sys_dN3rB(void) { return 409; }
int sys_NEorw(void) { return 491; }
int sys_iE45d(void) { return 379; }
int sys_VFGu_(void) { return 439; }
int sys_zqf7e(void) { return 493; }
int sys_Ayr5H(void) { return 425; }
int sys_y7dVW(void) { return 449; }
int sys_RhaR2(void) { return 415; }
int sys_GUT_3(void) { return 386; }
int sys_mtwGL(void) { return 491; }
int sys_Rz1qA(void) { return 431; }
int sys_BDslj(void) { return 463; }
int sys_DYcHF(void) { return 398; }
int sys_XVI4N(void) { return 377; }
int sys_RknTi(void) { return 488; }
int sys_eraAb(void) { return 475; }
int sys_K7plu(void) { return 467; }
int sys_UPjQy(void) { return 473; }
int sys_uFjK1(void) { return 417; }
int sys_E8Jj9(void) { return 362; }
int sys_viJpE(void) { return 478; }
int sys_y8hmu(void) { return 507; }
int sys_GhPNY(void) { return 422; }
int sys_mEymb(void) { return 506; }
int sys_UAi7z(void) { return 432; }
int sys_g3fke(void) { return 464; }
int sys_spiXC(void) { return 487; }
int sys_sCY6P(void) { return 405; }
int sys_lQ5p2(void) { return 404; }
int sys_yFLZV(void) { return 443; }
int sys_y7NBZ(void) { return 410; }
int sys_JS_81(void) { return 357; }
int sys_pHGgA(void) { return 423; }
int sys_D3BT2(void) { return 319; }
int sys_LYSUb(void) { return 431; }
int sys_UHDeS(void) { return 409; }
int sys_zQQm5(void) { return 446; }
int sys_T4IiC(void) { return 381; }
int sys_ZnCtG(void) { return 454; }
int sys_TBDYx(void) { return 427; }
int sys_k_jNM(void) { return 463; }



extern int sys_aaICO(void);
extern int sys_RwwzQ(void);
extern int sys_vPlkH(void);
extern int sys_nAAkW(void);
extern int sys_V4XHy(void);
extern int sys_DIJ1J(void);
extern int sys_uby8E(void);
extern int sys_HrYmw(void);
extern int sys_It9GD(void);
extern int sys_kBqyL(void);
extern int sys_uFvqh(void);
extern int sys_kCOzo(void);
extern int sys_BdglP(void);
extern int sys_vsu9T(void);
extern int sys_GhENr(void);
extern int sys_cNlc2(void);
extern int sys_AUX47(void);
extern int sys_OJjUF(void);
extern int sys_rwbCB(void);
extern int sys_U63O6(void);
extern int sys_buYn9(void);
extern int sys_pvRfc(void);
extern int sys_IbIsf(void);
extern int sys_RH7FR(void);
extern int sys_u5Ncu(void);
extern int sys_vA3kF(void);
extern int sys_ZyJFv(void);
extern int sys_a_kuY(void);
extern int sys_DF2ak(void);
extern int sys_bifXB(void);
extern int sys_OpuAe(void);
extern int sys_DNUxN(void);
extern int sys_ancIB(void);
extern int sys_fiuCL(void);
extern int sys_f85c4(void);
extern int sys_pKQyj(void);
extern int sys_sPh9f(void);
extern int sys_aSdV9(void);
extern int sys_hEwee(void);
extern int sys_m7xSo(void);
extern int sys_lpg5S(void);
extern int sys_J7GF1(void);
extern int sys_GYEGy(void);
extern int sys_UHuoA(void);
extern int sys_lfawm(void);
extern int sys_SkxVQ(void);
extern int sys_m7dk_(void);
extern int sys_C2FTH(void);
extern int sys_ZFvwG(void);
extern int sys_xMznMiMbd2ASBAopjUBD(void);


extern int sys_ajJ2rUS36Ds7gCvYhWvRMQ4cM(void);
extern int sys_lcQQ6(void);
extern int sys_tG0cd(void);
extern int sys_BQaye(void);
extern int sys_vRL61(void);
extern int sys_BfPAS(void);
extern int sys_VWqcU(void);
extern int sys_rNV_x(void);
extern int sys_m9TVP(void);
extern int sys_dN3rB(void);
extern int sys_NEorw(void);
extern int sys_iE45d(void);
extern int sys_VFGu_(void);
extern int sys_zqf7e(void);
extern int sys_Ayr5H(void);
extern int sys_y7dVW(void);
extern int sys_RhaR2(void);
extern int sys_GUT_3(void);
extern int sys_mtwGL(void);
extern int sys_Rz1qA(void);
extern int sys_BDslj(void);
extern int sys_DYcHF(void);
extern int sys_XVI4N(void);
extern int sys_RknTi(void);
extern int sys_eraAb(void);
extern int sys_K7plu(void);
extern int sys_UPjQy(void);
extern int sys_uFjK1(void);
extern int sys_E8Jj9(void);
extern int sys_viJpE(void);
extern int sys_y8hmu(void);
extern int sys_GhPNY(void);
extern int sys_mEymb(void);
extern int sys_UAi7z(void);
extern int sys_g3fke(void);
extern int sys_spiXC(void);
extern int sys_sCY6P(void);
extern int sys_lQ5p2(void);
extern int sys_yFLZV(void);
extern int sys_y7NBZ(void);
extern int sys_JS_81(void);
extern int sys_pHGgA(void);
extern int sys_D3BT2(void);
extern int sys_LYSUb(void);
extern int sys_UHDeS(void);
extern int sys_zQQm5(void);
extern int sys_T4IiC(void);
extern int sys_ZnCtG(void);
extern int sys_TBDYx(void);
extern int sys_k_jNM(void);

//extern int sys_lsr(void);


static int (*syscalls2[])(void) = {
[SYS_aaICO]    sys_aaICO,
[SYS_RwwzQ]    sys_RwwzQ,
[SYS_vPlkH]    sys_vPlkH,
[SYS_nAAkW]    sys_nAAkW,
[SYS_V4XHy]    sys_V4XHy,
[SYS_DIJ1J]    sys_DIJ1J,
[SYS_uby8E]    sys_uby8E,
[SYS_HrYmw]    sys_HrYmw,
[SYS_It9GD]    sys_It9GD,
[SYS_kBqyL]    sys_kBqyL,
[SYS_uFvqh]    sys_uFvqh,
[SYS_kCOzo]    sys_kCOzo,
[SYS_BdglP]    sys_BdglP,
[SYS_vsu9T]    sys_vsu9T,
[SYS_GhENr]    sys_GhENr,
[SYS_cNlc2]    sys_cNlc2,
[SYS_AUX47]    sys_AUX47,
[SYS_OJjUF]    sys_OJjUF,
[SYS_rwbCB]    sys_rwbCB,
[SYS_U63O6]    sys_U63O6,
[SYS_buYn9]    sys_buYn9,
[SYS_pvRfc]    sys_pvRfc,
[SYS_IbIsf]    sys_IbIsf,
[SYS_RH7FR]    sys_RH7FR,
[SYS_u5Ncu]    sys_u5Ncu,
[SYS_vA3kF]    sys_vA3kF,
[SYS_ZyJFv]    sys_ZyJFv,
[SYS_a_kuY]    sys_a_kuY,
[SYS_DF2ak]    sys_DF2ak,
[SYS_bifXB]    sys_bifXB,
[SYS_OpuAe]    sys_OpuAe,
[SYS_DNUxN]    sys_DNUxN,
[SYS_ancIB]    sys_ancIB,
[SYS_fiuCL]    sys_fiuCL,
[SYS_f85c4]    sys_f85c4,
[SYS_pKQyj]    sys_pKQyj,
[SYS_sPh9f]    sys_sPh9f,
[SYS_aSdV9]    sys_aSdV9,
[SYS_hEwee]    sys_hEwee,
[SYS_m7xSo]    sys_m7xSo,
[SYS_lpg5S]    sys_lpg5S,
[SYS_J7GF1]    sys_J7GF1,
[SYS_GYEGy]    sys_GYEGy,
[SYS_UHuoA]    sys_UHuoA,
[SYS_lfawm]    sys_lfawm,
[SYS_SkxVQ]    sys_SkxVQ,
[SYS_m7dk_]    sys_m7dk_,
[SYS_C2FTH]    sys_C2FTH,
[SYS_ZFvwG]    sys_ZFvwG,
[SYS_xMznMiMbd2ASBAopjUBD]    sys_xMznMiMbd2ASBAopjUBD,
};


char* randStr[50] = { "aaICO", "RwwzQ", "vPlkH", "nAAkW", "V4XHy", "DIJ1J", "uby8E", "HrYmw", "It9GD", "kBqyL", "uFvqh", "kCOzo", "BdglP", "vsu9T", "GhENr", "cNlc2", "AUX47", "OJjUF", "rwbCB", "U63O6", "buYn9", "pvRfc", "IbIsf", "RH7FR", "u5Ncu", "vA3kF", "ZyJFv", "a_kuY", "DF2ak", "bifXB", "OpuAe", "DNUxN", "ancIB", "fiuCL", "f85c4", "pKQyj", "sPh9f", "aSdV9", "hEwee", "m7xSo", "lpg5S", "J7GF1", "GYEGy", "UHuoA", "lfawm", "SkxVQ", "m7dk_", "C2FTH", "ZFvwG", "xMznMiMbd2ASBAopjUBD" };
//linear search
void
syscall2(void)
{
  char *str = (char *)proc->tf->eax;  

  int i,flag=0;
  for(i=0; i<50;i++)
  {
  	int len = strlen(str);
  	if(len == strlen(randStr[i]))
  	{
  		if(strncmp(str,randStr[i],len)==0)
	  	{
 	  		proc->tf->eax= syscalls2[i+1]();
	  		flag =1;
	  		break;
	  	}
  	}
  }
  if(flag == 0)
  {
  	  	cprintf("%d %s: unknown sys call %s\n", proc->pid, proc->name, str);
    	proc->tf->eax = -1;
  }

}


//syscall hashtable
#define SIZE 50
#define NULL (void*)0
struct entry {
   char* key;
   int (*name)(void);
};

int flag3 =0;
char* randStrKey[50] = { "ajJ2rUS36Ds7gCvYhWvRMQ4cM", "lcQQ6", "tG0cd", "BQaye", "vRL61", "BfPAS", "VWqcU", "rNV_x", "m9TVP", "dN3rB", "NEorw", "iE45d", "VFGu_", "zqf7e", "Ayr5H", "y7dVW", "RhaR2", "GUT_3", "mtwGL", "Rz1qA", "BDslj", "DYcHF", "XVI4N", "RknTi", "eraAb", "K7plu", "UPjQy", "uFjK1", "E8Jj9", "viJpE", "y8hmu", "GhPNY", "mEymb", "UAi7z", "g3fke", "spiXC", "sCY6P", "lQ5p2", "yFLZV", "y7NBZ", "JS_81", "pHGgA", "D3BT2", "LYSUb", "UHDeS", "zQQm5", "T4IiC", "ZnCtG", "TBDYx", "k_jNM" };
//char* randStrSys[50] = { "SYS_ajJ2rUS36Ds7gCvYhWvRMQ4cM", "SYS_lcQQ6", "SYS_tG0cd", "SYS_BQaye", "SYS_vRL61", "SYS_BfPAS", "SYS_VWqcU", "SYS_rNV_x", "SYS_m9TVP", "SYS_dN3rB", "SYS_NEorw", "SYS_iE45d", "SYS_VFGu_", "SYS_zqf7e", "SYS_Ayr5H", "SYS_y7dVW", "SYS_RhaR2", "SYS_GUT_3", "SYS_mtwGL", "SYS_Rz1qA", "SYS_BDslj", "SYS_DYcHF", "SYS_XVI4N", "SYS_RknTi", "SYS_eraAb", "SYS_K7plu", "SYS_UPjQy", "SYS_uFjK1", "SYS_E8Jj9", "SYS_viJpE", "SYS_y8hmu", "SYS_GhPNY", "SYS_mEymb", "SYS_UAi7z", "SYS_g3fke", "SYS_spiXC", "SYS_sCY6P", "SYS_lQ5p2", "SYS_yFLZV", "SYS_y7NBZ", "SYS_JS_81", "SYS_pHGgA", "SYS_D3BT2", "SYS_LYSUb", "SYS_UHDeS", "SYS_zQQm5", "SYS_T4IiC", "SYS_ZnCtG", "SYS_TBDYx", "SYS_k_jNM" };
struct entry e6 = {"ajJ2rUS36Ds7gCvYhWvRMQ4cM", sys_ajJ2rUS36Ds7gCvYhWvRMQ4cM};
struct entry e23 = {"lcQQ6", sys_lcQQ6};
struct entry e34 = {"tG0cd", sys_tG0cd};
struct entry e16 = {"BQaye", sys_BQaye};
struct entry e29 = {"vRL61", sys_vRL61};
struct entry e46 = {"BfPAS", sys_BfPAS};
struct entry e20 = {"VWqcU", sys_VWqcU};
struct entry e43 = {"rNV_x", sys_rNV_x};
struct entry e17 = {"m9TVP", sys_m9TVP};
struct entry e9 = {"dN3rB", sys_dN3rB};
struct entry e41 = {"NEorw", sys_NEorw};
struct entry e30 = {"iE45d", sys_iE45d};
struct entry e39 = {"VFGu_", sys_VFGu_};
struct entry e44 = {"zqf7e", sys_zqf7e};
struct entry e25 = {"Ayr5H", sys_Ayr5H};
struct entry e49 = {"y7dVW", sys_y7dVW};
struct entry e15 = {"RhaR2", sys_RhaR2};
struct entry e36 = {"GUT_3", sys_GUT_3};
struct entry e42 = {"mtwGL", sys_mtwGL};
struct entry e31 = {"Rz1qA", sys_Rz1qA};
struct entry e13 = {"BDslj", sys_BDslj};
struct entry e48 = {"DYcHF", sys_DYcHF};
struct entry e27 = {"XVI4N", sys_XVI4N};
struct entry e38 = {"RknTi", sys_RknTi};
struct entry e26 = {"eraAb", sys_eraAb};
struct entry e18 = {"K7plu", sys_K7plu};
struct entry e24 = {"UPjQy", sys_UPjQy};
struct entry e19 = {"uFjK1", sys_uFjK1};
struct entry e12 = {"E8Jj9", sys_E8Jj9};
struct entry e28 = {"viJpE", sys_viJpE};
struct entry e7 = {"y8hmu", sys_y8hmu};
struct entry e22 = {"GhPNY", sys_GhPNY};
struct entry e8 = {"mEymb", sys_mEymb};
struct entry e32 = {"UAi7z", sys_UAi7z};
struct entry e14 = {"g3fke", sys_g3fke};
struct entry e37 = {"spiXC", sys_spiXC};
struct entry e5 = {"sCY6P", sys_sCY6P};
struct entry e4 = {"lQ5p2", sys_lQ5p2};
struct entry e45 = {"yFLZV", sys_yFLZV};
struct entry e10 = {"y7NBZ", sys_y7NBZ};
struct entry e11 = {"JS_81", sys_JS_81};
struct entry e33 = {"pHGgA", sys_pHGgA};
struct entry e21 = {"D3BT2", sys_D3BT2};
struct entry e35 = {"LYSUb", sys_LYSUb};
struct entry e40 = {"UHDeS", sys_UHDeS};
struct entry e47 = {"zQQm5", sys_zQQm5};
struct entry e50 = {"T4IiC", sys_T4IiC};
struct entry e51 = {"ZnCtG", sys_ZnCtG};
struct entry e52 = {"TBDYx", sys_TBDYx};
struct entry e53 = {"k_jNM", sys_k_jNM};

struct entry e1 = {"k_jNM", sys_k_jNM};
struct entry e2 = {"k_jNM", sys_k_jNM};
struct entry e3 = {"k_jNM", sys_k_jNM};
struct entry e0 = {"k_jNM", sys_k_jNM};

struct entry* hashTable[54] = { &e0, &e1, &e2, &e3, &e4, &e5, &e6, &e7, &e8, &e9, &e10, &e11, &e12, &e13, &e14, &e15, &e16, &e17, &e18, &e19, &e20, &e21, &e22, &e23, &e24, &e25, &e26, &e27, &e28, &e29, &e30, &e31, &e32, &e33, &e34, &e35, &e36, &e37, &e38, &e39, &e40, &e41, &e42, &e43, &e44, &e45, &e46, &e47, &e48, &e49, &e50, &e51, &e52, &e53 };

//int (*syscalls3[])(void) = { [0] sys_ajJ2rUS36Ds7gCvYhWvRMQ4cM, [1] sys_lcQQ6, [2] sys_tG0cd, [3] sys_BQaye, [4] sys_vRL61, [5] sys_BfPAS, [6] sys_VWqcU, [7] sys_rNV_x, [8] sys_m9TVP, [9] sys_dN3rB, [10] sys_NEorw, [11] sys_iE45d, [12] sys_VFGu_, [13] sys_zqf7e, [14] sys_Ayr5H, [15] sys_y7dVW, [16] sys_RhaR2, [17] sys_GUT_3, [18] sys_mtwGL, [19] sys_Rz1qA, [20] sys_BDslj, [21] sys_DYcHF, [22] sys_XVI4N, [23] sys_RknTi, [24] sys_eraAb, [25] sys_K7plu, [26] sys_UPjQy, [27] sys_uFjK1, [28] sys_E8Jj9, [29] sys_viJpE, [30] sys_y8hmu, [31] sys_GhPNY, [32] sys_mEymb, [33] sys_UAi7z, [34] sys_g3fke, [35] sys_spiXC, [36] sys_sCY6P, [37] sys_lQ5p2, [38] sys_yFLZV, [39] sys_y7NBZ, [40] sys_JS_81, [41] sys_pHGgA, [42] sys_D3BT2, [43] sys_LYSUb, [44] sys_UHDeS, [45] sys_zQQm5, [46] sys_T4IiC, [47] sys_ZnCtG, [48] sys_TBDYx, [49] sys_k_jNM,  };


/*void setup()
{
	int w;
	for(w=0;w<50;w++)
	{
		int arr[54];
		int k=0;
		for(k=0;k<54;k++)
		{
			arr[k] = -1;
		}
		struct entry *e = (struct entry*) (sizeof(struct entry));   
		char* temp = randStrKey[w];
		e-> key = temp;
		e-> name = syscalls3[w];
		int indexHash = hc(temp);
		
		while(arr[indexHash] != -1)
		{
			++indexHash;
			indexHash = indexHash % SIZE;
		}
		hashTable[indexHash] = e;
		arr[indexhash] = 1;
	}
	int l=0;
	for (l = 0; l < 50; l++)
	{
		cprintf("key : %s\n",hashTable[l]->key);
	}

}*/
void 
hashsearch(char* key)
{
	int hindex = hc(key);
	int count = 0;
	
	
	while(count<50)
	{
		if(strncmp(hashTable[hindex]->key,key,strlen(key))==0)
		{
			proc->tf->eax = (int) hashTable[hindex]->name();
			flag3 = 1;
			break;
		}
		++hindex;
		hindex = hindex % SIZE;
		count++;
	}
}
int hc(char* key)
{
	int c,hashVal=0;
	int keyLen = strlen(key);
	for(c=0;c<keyLen;c++)
	{
		hashVal = hashVal + key[c];
	}
	return hashVal % SIZE;
}
void
syscall3(void)
{
	char *str = (char *)proc->tf->eax;
	hashsearch(str);
	if(flag3 != 1)
	{
		cprintf("%d %s: unknown sys call %s\n", proc->pid, proc->name, str);
    	proc->tf->eax = -1;
	}
}
